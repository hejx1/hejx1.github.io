---
layout: post
title: mysql 常用笔记
date: 2017-02-06
tags: mysql    
---

### 新增字段

```
alter table tableName add newColumn varchar(8) comment '新添加的字段';
```
### 修改字段

```
ALTER TABLE tb_recharge MODIFY COLUMN pay_platform int(11) NOT NULL COMMENT '支付平台';
```
### 删除字段

```
-- 删除事件表中的事件描述字段
alter table `tb_event` drop column event_desc;
```

### 将A表的数据拷贝到B表

每个字段需要数据类型相同,这里的例子是将以前用户表存储的role_id拷贝到用户角色关系表

```
INSERT INTO tb_user_role(user_id,role_id)  
SELECT pk_id,role_id FROM tb_user WHERE role_id IS NOT NULL AND role_id <> ''
```



### 循环插入数据（id自增）

```
BEGIN 

DECLARE i INT DEFAULT 1;

WHILE i<6000
DO 
INSERT INTO `login_info`(name,role_uid,acc_id,sid,sex,login_ip,login_time,money,gold,roomcard,sum_online,create_time) VALUES ('hy', '100087', 'test.hy', '01', '1', '192.168.2.50', '2017-08-21 19:22:10', '0', '0', '0', '220', '2017-08-16 11:33:04');
SET i=i+1; 
END WHILE ; 
commit; 

END
```

### Mysql将数据分组后取出时间最近的数据

这一种查询较为耗时，不推荐使用，6000条正常数据左右就耗时2秒多，伤不起

```
select id,name,role_uid,acc_id,sid,sex,login_ip,login_time,money,gold,roomcard,sum_online from login_info as b
where not exists(select 1 from login_info
	where role_uid = b.role_uid
	and b.login_time<login_time )  ORDER BY login_time DESC limit 0,10
```
下面这种推荐使用
```
sql: select id,name,role_uid,acc_id,sid,sex,login_ip,login_time,money,gold,roomcard,sum_online from (select * from login_info	ORDER BY login_time DESC ) t GROUP BY t.role_uid ORDER BY login_time DESC limit 0,10

count_sql: SELECT COUNT(DISTINCT role_uid) FROM login_info 
```
